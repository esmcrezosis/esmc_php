<div id="view-content" class="ui-widget" title='Identification : Maison Opératrice Socio Economique' style="font-size:8px;min-height:520px;">
     <div id="formdiv" class="ui-widget-content ui-corner-bottom">
          <form id="fm_maison" action="/eu-maison/new" method="POST">
		        <input type="hidden" name="cpteur" id="cpteur" value="1"/>
		        <fieldset style="margin-bottom:2px;"><legend>Agréments</legend>
		           <table>
			             <tr>
				            <td>Numéro Agrément Filière *</td>
					        <td><input name="agrement_filiere" id="agrement_filiere" value="<?php echo $this->agrement_filiere; ?>" class="validate[required]" size="50"></td>
				         </tr>
					     <tr>
				            <td>Numéro Agrément ACNEV *</td>
					        <td><input name="agrement_acnev" id="agrement_acnev" class="validate[required]" value="<?php echo $this->agrement_acnev; ?>" size="50"></td>
				         </tr>
					     <tr>
				            <td>Numéro Agrément Technopole *</td>
					        <td><input name="agrement_technopole" id="agrement_technopole" value="<?php echo $this->agrement_technopole; ?>" class="validate[required]" size="50"></td>
				         </tr>
			    </table>
		   </fieldset>
               <fieldset><legend>CM</legend>
                   <table>
                         <tr>
                            <td>Frais de solvabilité *</td><td><input  class="validate[required,custom[onlyNumberSp]]" maxlength="10" name="frais_identification" id="frais_identification" readonly="true"  value="<?php echo $this->fs; ?>"/></td>
                            <td>Code SMS *</td><td><input name="code_sms" id="code_sms" class="validate[required]" maxlength="8" value="<?php echo $this->code_sms; ?>"></td>
                         </tr>
                   </table>
               </fieldset>
               <fieldset><legend>Informations</legend>
                     <table>
                           <tbody>
                              <tr>
                                  <td>Numéro </td>
                                  <td>
                                      <input  id="numero" name="numero" class="validate[integer]"  value="<?php echo $this->numero ?>" />
                                  </td>
                                  <td>D&eacute;signation *</td>
                                  <td>
                                      <input id="design" name="design" value="<?php echo $this->design ?>" class="validate[required]"/>
                                  </td>
                              </tr>
                          <tr><td height="4px"></td></tr>    
                          <tr>
                            <td width="170px">Catégorie *</td>
                            <td width="570px">
                                <select name="type_acteur" id="type_acteur" class="validate[required]" value="<?php echo $this->type_acteur ?>">
                                    <option value=""></option>
                                    <option value="OSE" >OSE</option>
									<!--<option value="EI" >EI</option>-->
                                </select>
                            </td>
                            <td width="240px">Statut juridique *</td>
                            <td>
                                <select id="statut_juridique" name="statut_juridique" class="validate[required]" value="<?php echo $this->statut_juridique ?>"></select>
                            </td>
                        </tr>
                              <tr><td height="4px"></td></tr>
                              <tr>
                                  <td>Type </td>
                                  <td><input name="type_maison" id="type_maison"  value="<?php echo $this->type_maison ?>"/></td>
                                  <td>Pays *</td><td ><select id="id_pays"  type="text" name="id_pays" class="validate[required]" value=""/></td>
                              </tr>
                              <tr><td height="4px"></td></tr>
                              <tr>
                                  <td>Ville *</td>
                                  <td>
                                      <input name="ville" id="ville"  class="validate[required]" value="<?php echo $this->quartier ?>"/>
                                  </td>
                                  <td>Quartier *</td>
                                  <td>
                                      <input name="quartier" id="quartier"  class="validate[required]" value="<?php echo $this->quartier ?>"/>
                                  </td>
                                  
                              </tr>
                              <tr><td height="4px"></td></tr>
                              <tr>
                                  <td>Rue *</td>
                                  <td>
                                      <input name="rue" id="rue"  class="validate[required]" value="<?php echo $this->rue ?>"/>
                                  </td>
                                  <td valign="top">Description</td>
                                  <td colspan="3">
                                      <textarea name="desc" id="desc"  rows="30" cols="100">
                                          <?php echo $this->desc ?>    
                                      </textarea>
                                  </td>
                              </tr>
                              <tbody>
                        </table>            
               </fieldset>
			   <fieldset style="margin-bottom: 2px;">
                <legend>Proprietaire</legend>
                <table>
                       <tr>
					       <td>Code membre *</td><td><input size="30" name="code_rep" id="code_rep"  class="validate[required]" value="<?php echo $this->code_membre ?>"/> </td>
                           <td>Nom & Prénom *</td><td><input size="35" name="nom_rep" id="nom_rep" class="validate[required]" value="<?php echo $this->nom_membre ?>" readonly="true"/></td>
					   </tr>
				</table>
            </fieldset>
			<!-- <fieldset>
			<legend>Residents</legend>
			        <table border="1" rules="all" id="tab_resident">
					    <thead>
                              <th>Code membre </th><th>Nom & Prénom</th>
                        </thead>
						<tbody>
						    <tr>
				               <td><input type="text" id="code_res1" name="code_res1" value=""  size="30"/></td>
                               <td><input type="text" id="nom_res1" name="nom_res1" value=""   size="30"/></td>
							   <td>
							      <input type="button" id="add_resident" value="+" onclick="addRow('tab_resident')"/>
							      <input type="button" id="del_resident" value="-" onclick="deleteRow('tab_resident')"/>
							   </td>
							</tr>
						</tbody>
						   
				    </table>
			</fieldset> -->
               <fieldset><legend>Charges</legend>
                         <table>
                            <tbody>
                                <tr>
                                    <td>
                                        Eau <br>
                                        <input type="checkbox" id="eau" name="eau" value="1">
                                    </td>
                                    
                                    <td colspan="4"></td>
                                    
                                    <td valign="top">Frais d'eau</td> 
                                    <td>
									    <input type="text" class="validate[custom[number]]" id="frais_eau" name="frais_eau">
										<input type="text" id="dev_eau" name="dev_eau" value="XOF" readonly="true" size="2">
									</td>
									
                                    <td width="10px"></td>
                                    <td valign="top">N°compteur eau</td>     
                                    <td><input type="text" id="num_compteur" name="num_compteur" required="true"></td> 
                                </tr>
                                <tr>
                                   <td>Electricit&eacute;<br><input type="checkbox" id="elect" name="elect" value="1"> </td>
                                   
                                   <td colspan="4"></td>
                                   
                                   <td valign="top">Frais électricité</td>
                                   <td>
								      <input type="text" class="validate[custom[number]]" id="frais_elect" name="frais_elect">
									  <input type="text" id="dev_elect" name="dev_elect" value="XOF" readonly="true" size="2">
									  
								   </td>
                                   <td width="10px"></td>
                                   <td valign="top">N°police électricité</td>
                                   <td><input type="text" required="true"  id="num_police" name="num_police"></td>
                                </tr>
                                
                                <tr>
                                   <td>Téléphone<br><input type="checkbox" id="tel" name="tel" value="1"> </td>
                                   <td colspan="4"></td>
                                   
                                   <td valign="top">Frais téléphoniques</td>
                                   <td>
								       <input type="text" id="frais_tel" name="frais_tel" class="validate[custom[number]]" >
									   <input type="text" id="dev_tel" name="dev_tel" value="XOF" readonly="true" size="2">
								   </td>
								   <td width="10px"></td>
                                   <td valign="top">N°ligne téléphonique</td>
                                   <td><input type="text" required="true" id="num_ligne" name="num_ligne"></td>  
                               </tr>
                               
                               <tr>
                                   <td>Wc-Douche<br><input type="checkbox" id="wd" name="wd" value="1"></td>
                                   <td colspan="4"></td>
                                   <td valign="top">Frais vidange</td>
                                   <td>
								      <input type="text" id="frais_vidange" name="frais_vidange" class="validate[custom[number]]">
									  <input type="text" id="dev_vidange" name="dev_vidange" value="XOF" readonly="true" size="2">
								   </td>
								   <td width="10px"></td>
                                   <td>Loyer &nbsp; Montant loyer<br><input type="checkbox" id="loyer" name="loyer" value="1"></td>
                                   <td>
								       <input type="text" class="validate[custom[number]]" id="mt_loyer" name="mt_loyer">
									   <input type="text" id="dev_loyer" name="dev_loyer" value="XOF" readonly="true" size="2">
								   </td>    
                               </tr>
							   <tr>
								   <td>Autres Charges <br> <input type="checkbox" id="autre_charge" name="autre_charge" value="1"></td>
                                   <td colspan="4"></td>
                                   <td valign="top">Frais</td>
                                   <td>
								      <input type="text" id="frais_charge" name="frais_charge" class="validate[custom[number]]">
									  <input type="text" id="dev_charge" name="dev_charge" value="XOF" readonly="true" size="2">
								   </td>
								   
								   <td width="10px"></td>
                                   <td>Taxe &nbsp; Montant taxe<br><input type="checkbox" id="radio_taxe" name="radio_taxe" value="1"></td>
                                   <td>
								       <input type="text" class="validate[custom[number]]" id="taxe" name="taxe">
									   <input type="text" id="dev_taxe" name="dev_taxe" value="XOF" readonly="true" size="2">
								   </td>   
                               </tr>
                            </tbody>
                        </table>
               </fieldset>
               <fieldset>
                   <legend>Autres informations</legend>
                   <table>
                         <tbody>
                         <tr>
                             
                             <td>BP</td><td><input id="bp_membre" name="bp_membre" value="<?php echo $this->bp ?>"/>
                             </td>
                         </tr>
                         <tr>
                             <td>Téléphone </td><td><input id="tel_membre" name="tel_membre"  class="validate[custom[integer]]" value="<?php echo $this->tel ?>"/></td>
                             <td width="10px"></td>
							 <td>Téléphone portable *</td><td><input id="portable_membre" required="true" name="portable_membre" class="validate[custom[integer]]" value="<?php echo $this->portable ?>"></td>
                         
                         </tr>
                         <tr>
                             <td>Adresse électronique</td><td><input name="email_membre" class="validate[custom[email]]" value="<?php echo $this->email ?>"/></td> 
                             <td width="10px"></td>
							 <td>Site web</td><td><input name="site_web" /></td>
                         </tr>
                         <tbody>
                   </table>
               </fieldset>
               <div style="margin-top: 10px;">
			        <input name="codesecret" type="hidden" id="codesecret" value="<?php echo $this->codesecret; ?>" />
                    <input type="submit" value="Valider" id="valider"/>
                    <input type="reset" value="Rafraichir" id="refresh"/>
                    <input id="t_annuler" type="button" value="Annuler"/>
               </div>
         </form>  
</div>
<script type="text/javascript">   
    $(document).ready(function () {
        
      $("#fm_maison").validationEngine();
      $('#view-content').puipanel();
      $('fieldset').puifieldset();
      
      $.get( "/eu-maison/membrephys",
        function success(data) {
        $("#code_rep").autocomplete({"source":data});
      });
	  
	  $.get( "/eu-maison/membrephys",
        function success(data) {
        $("#code_res1").autocomplete({"source":data});
      });
	  
	  $('#code_res1').blur(function(e) {
        if($(this).val() !== '') {
        $.get(
           '/eu-maison/recupnom',{
           num_membre: $(this).val()
        },
        function success(data) {
          $("#nom_res1").val(data);
        });
       }
        e.preventDefault();
    });
	  
							
	  $('#code_rep').blur(function(e) {
        if($(this).val() !== '') {
        $.get(
           '/eu-maison/recupnom',{
           num_membre: $(this).val()
        },
        function success(data) {
          $("#nom_rep").val(data);
        });
       }
        e.preventDefault();
    });
	
	
    $.get("/eu-maison/pays",
        function success(data) {
        var options = '<option/>';
        for (var i = 0; i < data.length; i++) {
            options += '<option value="' + data[i][0] + '">' + data[i][1] + ' </option>';
        }
        $('select#id_pays').html(options);
    });    

	
        $('#frais_eau').attr('readonly',true);
        $('#num_compteur').attr('readonly',true);
        $('#frais_elect').attr('readonly',true);
        $('#num_police').attr('readonly',true);
        $('#frais_tel').attr('readonly',true);
        $('#num_ligne').attr('readonly',true);
        $('#frais_vidange').attr('readonly',true);
		$('#frais_charge').attr('readonly',true);
		$('#mt_loyer').attr('readonly',true);
		$('#taxe').attr('readonly',true);
         
		$('#loyer').change(function() {
             if(document.getElementById('loyer').checked) {
                $('#mt_loyer').attr('readonly',false);
        }
        else {
           $('#mt_loyer').attr('readonly',true);
           $('#mt_loyer').attr('value','');
        }
      });
		
	  
	  $('#autre_charge').change(function() {
             if(document.getElementById('autre_charge').checked) {
                $('#frais_charge').attr('readonly',false);
      }
      else {
           $('#frais_charge').attr('readonly',true);
           $('#frais_charge').attr('value','');
      }
   });
   
   
   $('#radio_taxe').change(function() {
    if(document.getElementById('radio_taxe').checked) {
      $('#taxe').attr('readonly',false);
   }
   else {
      $('#taxe').attr('readonly',true);
      $('#taxe').attr('value','');
   }
   });	
		
		 
		 
		  
          
        $('#eau').change(function() {
             if(document.getElementById('eau').checked) {
                $('#frais_eau').attr('readonly',false);
                $('#num_compteur').attr('readonly',false);
        }
        else {
                $('#frais_eau').attr('readonly',true);
                $('#num_compteur').attr('readonly',true);
                $('#frais_eau').attr('value','');
                $('#num_compteur').attr('value','');
        }
      });
          
          
        $('#elect').change(function() {
             if(document.getElementById('elect').checked) {
                $('#frais_elect').attr('readonly',false);
                $('#num_police').attr('readonly',false);
             }
             else {
                $('#frais_elect').attr('readonly',true);
                $('#num_police').attr('readonly',true);
                $('#frais_elect').attr('value','');
                $('#num_police').attr('value','');
             } 
        });
          
          
        $('#tel').change(function() {
             if(document.getElementById('tel').checked) {
                $('#frais_tel').attr('readonly',false);
                $('#num_ligne').attr('readonly',false);
             }
             else {
                $('#frais_tel').attr('readonly',true);
                $('#num_ligne').attr('readonly',true);
                $('#frais_tel').attr('value','');
                $('#num_ligne').attr('value','');
             } 
        });
          
        $('#wd').change(function() {
             if(document.getElementById('wd').checked) {
                $('#frais_vidange').attr('readonly',false);
             }
             else {
                $('#frais_vidange').attr('readonly',true);
                $('#frais_vidange').attr('value','');
             } 
        });
          
		$("#type_acteur").change(function(e) {
          
                var code = $(this).val();
                if($(this).val() == 'OSE'){
                    code = 'OSE';
                }else{
                    code = 'EI';
                }
                $.get( "/eu-maison/statut",{type:code},
                function success(data)
                {
                    var options = '<option/>';
                    for( var i = 0; i < data.length; i++) {
                        options += '<option value="' + data[i] + '">' + data[i] +' </option>';
                    }
                    $('select#statut_juridique').html(options);
                });
                e.preventDefault();
        })
		   
        /* $('form#fm_maison').submit(function(e) {
            $.ajax({
                url: $('form').attr("action"),
                data: $('form').serialize(),
                type: 'post',
                success: processServerResponse
            });
            e.preventDefault();
        });
        
        function processServerResponse(data) {
            if(data === true) {
                alert('L\'enrégistrement a été effectué avec succès ');
                $(location).attr("href", "/eu-maison/index");
            }
            else {
                 $('#message').html(data);
            }
        };
      */           
  })
  
  
  
    var compteur = 1;
	function addRow(tableID) {					    
		var table = document.getElementById(tableID);
        var rowCount = table.rows.length;
        var cpte = rowCount;
        var row = table.insertRow(rowCount);
		var cell1 = row.insertCell(0);
        var element0 = document.createElement("input");
        element0.type = "text";
		element0.setAttribute("class", "validate[required]");
        element0.setAttribute("id", "code_res" + cpte);
        element0.setAttribute("name", "code_res" + cpte);
        element0.setAttribute("size", "30");
        cell1.appendChild(element0);
		$('#code_res'+ cpte).puiinputtext();
														
		var cell2 = row.insertCell(1);
        var element1 = document.createElement("input");
        element1.type = "text";
	    element1.setAttribute("class", "validate[required]");
        element1.setAttribute("id", "nom_res" + cpte);
        element1.setAttribute("name", "nom_res" + cpte);
        element1.setAttribute("size", "30");
        element1.setAttribute("readonly", "true");
        cell2.appendChild(element1);
		$('#nom_res'+ cpte).puiinputtext();
						
		$.get( "/eu-maison/membrephys",
          function success(data) {
          $("#code_res"+ cpte).autocomplete({"source":data});
        });
							
							
		$('#code_res'+ cpte).blur(function(e) {
            if($(this).val() !== '') {
                $.get(
                    '/eu-maison/recupnom',{
                    num_membre: $(this).val()
                },
                function success(data) {
                    $("#nom_res"+ cpte).val(data);
                });
            }
            e.preventDefault();
        });
			compteur = compteur + 1;
            document.getElementById("cpteur").setAttribute('value', compteur);
		}
							
		function deleteRow(tableID) {
        try {
            var table = document.getElementById(tableID);
            var rowCount = table.rows.length - 1;
            if (rowCount > 1) {
               table.deleteRow(rowCount);
               compteur = compteur - 1;
               document.getElementById("cpteur").setAttribute('value', compteur);
            }
        } catch(e) {
            alert(e);
        }
        }    
    </script>      
</div>